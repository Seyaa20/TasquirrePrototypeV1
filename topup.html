<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tasquirre – Top Up</title>
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />

<style>
:root {
  --bg: #fff6e6;
  --bg-soft: #ffe8c7;
  --accent: #c5652c;
  --text-main: #5a2c13;
  --border-soft: #f0d4af;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg);
  font-family: "Poppins", sans-serif;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding: 1.5rem 0;
  min-height: 100vh;
}

.screen {
  width: 100%;
  max-width: 428px;
  min-height: 100vh;
  background: var(--bg);
  padding-bottom: 1.5rem;
  overflow-y: auto;

  opacity: 0;
  transform: translateY(20px);
  transition: 0.35s ease;
}
.screen.loaded {
  opacity: 1;
  transform: translateY(0);
}

/* HEADER */
.header {
  display: flex;
  align-items: center;
  padding: 1rem 1.2rem 0.4rem;
  gap: 0.8rem;
}

.back-btn {
  width: 42px;
  height: 42px;
  border-radius: 999px;
  background: var(--bg-soft);
  display: flex;
  justify-content: center;
  align-items: center;
  color: var(--accent);
  font-size: 1.4rem;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  cursor: pointer;
  border: none;
}

.header-title {
  font-size: 1.35rem;
  font-weight: 700;
  color: var(--accent);
}

/* INPUT SECTION */
.topup-section {
  padding: 1.3rem 1.2rem;
}

.label {
  font-size: 0.95rem;
  font-weight: 600;
  color: var(--text-main);
  margin-bottom: 6px;
}

.topup-input {
  width: 100%;
  background: white;
  border: 2px solid var(--border-soft);
  border-radius: 18px;
  padding: 0.9rem 1rem;
  font-size: 1.1rem;
  color: var(--text-main);
  outline: none;
  transition: 0.25s ease;
}
.topup-input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(197, 101, 44, 0.22);
}

/* QUICK BUTTONS */
.quick-row {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0.8rem;
  margin-top: 1rem;
  margin-bottom: 1.2rem;
}

.quick-btn {
  background: white;
  border: 1.5px solid var(--border-soft);
  padding: 0.75rem 0;
  border-radius: 14px;
  text-align: center;
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--accent);
  cursor: pointer;
  transition: 0.25s ease;
}
.quick-btn:hover {
  background: var(--accent);
  color: white;
}

/* PAYMENT METHOD */
.method-row {
  margin-top: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
}

.method-item {
  background: white;
  padding: 0.8rem 1rem;
  border-radius: 14px;
  border: 1.5px solid var(--border-soft);
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 0.9rem;
  color: var(--text-main);
  cursor: pointer;
}

/* SUBMIT BUTTON */
.submit-btn {
  width: 100%;
  margin-top: 2rem;
  padding: 0.95rem;
  background: linear-gradient(135deg, #d07234, #c0521d);
  border: none;
  border-radius: 999px;
  color: white;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 12px 28px rgba(197, 101, 44, 0.28);
  transition: 0.25s ease;
}
.submit-btn:active {
  transform: scale(0.97);
}

/* TOAST */
.toast {
  position: fixed;
  top: -70px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(197,82,43,0.92);
  backdrop-filter: blur(6px);
  padding: 14px 22px;
  color: white;
  border-radius: 18px;
  opacity: 0;
  transition: 0.5s ease;
  z-index: 9999;
}
.toast.show {
  top: 90px;
  opacity: 1;
}
</style>
</head>

<body>

<div id="toast" class="toast">Top up berhasil</div>

<div class="screen" id="screen">

  <div class="header">
    <button class="back-btn" onclick="goBack()"><i class="bx bx-arrow-back"></i></button>
    <span class="header-title">Top Up</span>
  </div>

  <div class="topup-section">

    <label class="label" style="margin-top: 0.5 rem; display: block;">Masukkan Nominal</label>

    <input id="amount" class="topup-input" type="text" placeholder="contoh: 50.000,00">

    <div class="quick-row">
      <div class="quick-btn" onclick="setAmount(10000)">10.000</div>
      <div class="quick-btn" onclick="setAmount(25000)">25.000</div>
      <div class="quick-btn" onclick="setAmount(50000)">50.000</div>
      <div class="quick-btn" onclick="setAmount(100000)">100.000</div>
      <div class="quick-btn" onclick="setAmount(150000)">150.000</div>
      <div class="quick-btn" onclick="setAmount(200000)">200.000</div>
    </div>

    <label class="label" style="margin-top: 1.4rem; display: block;">Pilih Metode Pembayaran</label>

    <div class="method-row">
      <label class="method-item">
        <input type="radio" name="method" value="BLU by BCA"> BLU by BCA
      </label>
      <label class="method-item">
        <input type="radio" name="method" value="BCA Virtual Account"> BCA Virtual Account
      </label>
      <label class="method-item">
        <input type="radio" name="method" value="Jago"> Bank Jago
      </label>
      <label class="method-item">
        <input type="radio" name="method" value="Dana"> Dana
      </label>
      <label class="method-item">
        <input type="radio" name="method" value="OVO"> OVO
      </label>
      <label class="method-item">
        <input type="radio" name="method" value="Gopay"> Gopay
      </label>
    </div>

    <button class="submit-btn" onclick="submitTopUp()">Top Up Sekarang</button>

  </div>
</div>

<script>
/* ANIMASI MASUK */
window.onload = () => {
  document.getElementById("screen").classList.add("loaded");

  const input = document.getElementById("amount");

  input.addEventListener("input", function () {
    let val = this.value.replace(/[^0-9,]/g, "");

    let [intPart, decPart] = val.split(",");
    intPart = (intPart || "").slice(0, 12).replace(/^0+/, "") || "0";
    decPart = (decPart || "").slice(0, 2);

    let formattedInt = new Intl.NumberFormat("id-ID").format(intPart);

    this.value = val.includes(",")
      ? formattedInt + "," + decPart
      : formattedInt;
  });
};

function goBack() {
  const sc = document.getElementById("screen");
  sc.style.opacity = "0";
  sc.style.transform = "translateY(20px)";
  setTimeout(() => window.location.href = "home.html", 350);
}

function setAmount(num) {
  document.getElementById("amount").value = num.toLocaleString("id-ID", {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });
}

/* SUBMIT TOP UP */
/* SUBMIT TOP UP */
function submitTopUp() {
  let val = document.getElementById("amount").value.trim();

  if (!val) {
    showToast("Nominal tidak valid");
    return;
  }

  // Hilangkan titik dari format ribuan
  val = val.replace(/\./g, "");

  // Jika tidak ada koma, tambahkan ,00
  if (!val.includes(",")) val += ",00";

  // Pecah integer & desimal
  let [intPart, decPart] = val.split(",");
  if (!decPart) decPart = "00";
  if (decPart.length === 1) decPart += "0";
  if (decPart.length > 2) decPart = decPart.slice(0, 2);

  val = intPart + "," + decPart;

  const amount = parseFloat(val.replace(",", "."));

  if (isNaN(amount) || amount <= 0) {
    showToast("Nominal tidak valid");
    return;
  }

  // Ambil metode pembayaran
  const method = document.querySelector('input[name="method"]:checked');
  if (!method) {
    showToast("Pilih metode pembayaran dulu");
    return;
  }

  // Update saldo
  let saldo = parseFloat(localStorage.getItem("saldoTasquirre") || "0");
  let newSaldo = saldo + amount;
  localStorage.setItem("saldoTasquirre", newSaldo);

  // Format Rp 20.000,00
  const formattedForNotif = amount.toLocaleString("id-ID", {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });

  // Simpan notifikasi
  let notifList = JSON.parse(localStorage.getItem("notifTasquirre") || "[]");

  notifList.unshift({
    text: `Top up Rp${formattedForNotif} via ${method.value} berhasil`,
    read: false,
    time: new Date().toLocaleString("id-ID")
  });

  localStorage.setItem("notifTasquirre", JSON.stringify(notifList));

  // ================================
  //   SIMPAN KE RIWAYAT TRANSAKSI
  // ================================
  let history = JSON.parse(localStorage.getItem("saldoHistoryTasquirre") || "[]");

  history.unshift({
    type: "in",                       // <— WAJIB biar masuk ke tab Uang Masuk
    amount: formattedForNotif,        // contoh: 20.000,00
    desc: `Top Up via ${method.value}`,
    time: new Date().toLocaleString("id-ID")
  });

  localStorage.setItem("saldoHistoryTasquirre", JSON.stringify(history));

  // Toast dan redirect
  showToast("Top up berhasil!");

  setTimeout(() => {
    window.location.href = "home.html";
  }, 1500);
}

/* TOAST */
function showToast(msg) {
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(() => t.classList.remove("show"), 1800);
}
</script>

</body>
</html>

